<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiger & Hunters</title>
    <style>
        body { margin: 0; padding: 20px; background: #2c3e50; font-family: sans-serif; }
        #game-container { display: flex; gap: 20px; background: white; padding: 20px; border-radius: 10px; }
        canvas { border: 2px solid #34495e; cursor: pointer; }
        #ui { width: 250px; }
        #turn-indicator { color: #e74c3c; margin: 0 0 20px 0; }
        #reset-btn { width: 100%; padding: 10px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #debug { font-size: 12px; color: #c0392b; margin-top: 20px; font-family: monospace; }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="800"></canvas>
        <div id="ui">
            <h1 id="turn-indicator">Loading...</h1>
            <button id="reset-btn">New Game</button>
            <div id="rules">
                <h3>How to Play</h3>
                <p>Click a piece, then click where you want it to move.</p>
            </div>
            <div id="debug"></div>
        </div>
    </div>

    <script>
        console.log("SCRIPT STARTED"); // Debug line 1

        // --- Simple Vector ---
        class Vector2 {
            constructor(x, y) { this.x = x; this.y = y; }
            distanceTo(other) { return Math.sqrt((this.x - other.x) ** 2 + (this.y - other.y) ** 2); }
            clone() { return new Vector2(this.x, this.y); }
        }

        // --- Piece ---
        class Piece {
            constructor(pos, color, isTiger = false) {
                this.pos = pos;
                this.color = color;
                this.isTiger = isTiger;
                this.incapacitated = false;
                this.radius = 15;
            }
            
            draw(ctx) {
                console.log(`Drawing piece at ${this.pos.x}, ${this.pos.y}`); // Debug each piece
                const color = this.incapacitated ? '#333333' : this.color;
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(this.pos.x, this.pos.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                if (this.incapacitated) {
                    ctx.strokeStyle = '#e74c3c';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(this.pos.x - 10, this.pos.y - 10);
                    ctx.lineTo(this.pos.x + 10, this.pos.y + 10);
                    ctx.stroke();
                }
            }
        }

        // --- Constants ---
        const HAND_SPAN = 150;
        const CLEARING_RADIUS = 300;
        const BORDERLANDS_WIDTH = HAND_SPAN;
        const CENTER = new Vector2(400, 400);

        console.log("CONSTANTS DEFINED"); // Debug line 2

        // --- Game ---
        class Game {
            constructor() {
                console.log("Game constructor called"); // Debug line 3
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.center = CENTER;
                this.reset();
            }
            
            reset() {
                console.log("Resetting game..."); // Debug line 4
                this.tiger = new Piece(this.center.clone(), '#e74c3c', true);
                
                // Place hunters visibly in Borderlands
                this.hunters = [];
                for (let i = 0; i < 5; i++) {
                    const angle = (i * 72) * Math.PI / 180; // 72 degrees apart
                    const dist = CLEARING_RADIUS + 50; // Explicitly visible
                    const pos = new Vector2(
                        this.center.x + Math.cos(angle) * dist,
                        this.center.y + Math.sin(angle) * dist
                    );
                    this.hunters.push(new Piece(pos, '#27ae60'));
                }
                
                this.turn = 'TIGER';
                this.huntersMoved = new Set();
                this.selectedPiece = null;
                this.winner = null;
                
                console.log(`Tiger at: ${this.tiger.pos.x}, ${this.tiger.pos.y}`);
                console.log(`Hunters: ${this.hunters.length} pieces`);
            }
            
            draw() {
                console.log("Draw called"); // Debug line 5
                // Clear
                this.ctx.fillStyle = '#ecf0f1';
                this.ctx.fillRect(0, 0, 800, 800);
                
                // Draw zones
                this.ctx.strokeStyle = '#f39c12';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(this.center.x, this.center.y, CLEARING_RADIUS, 0, Math.PI * 2);
                this.ctx.stroke();
                
                this.ctx.strokeStyle = '#3498db';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.arc(this.center.x, this.center.y, CLEARING_RADIUS + BORDERLANDS_WIDTH, 0, Math.PI * 2);
                this.ctx.stroke();
                
                // Draw pieces
                this.tiger.draw(this.ctx);
                this.hunters.forEach(h => h.draw(this.ctx));
            }
        }

        // --- Initialization ---
        console.log("Before window.onload"); // Debug line 6

        window.addEventListener('load', () => {
            console.log("Window loaded - starting game"); // Debug line 7
            
            try {
                const game = new Game();
                game.draw();
                document.getElementById('turn-indicator').textContent = "Tiger's Turn - Click to Start!";
                console.log("Game initialized successfully"); // Debug line 8
            } catch (error) {
                console.error("CRASH:", error);
                document.getElementById('debug').textContent = `ERROR: ${error.message}`;
            }
        });

        console.log("Script ended"); // Debug line 9
    </script>
</body>
</html>
